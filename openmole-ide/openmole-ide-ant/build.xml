<?xml version="1.0" encoding="UTF-8"?>
<!-- You may freely edit this file. See harness/README in the NetBeans platform -->
<!-- for some information on what you could do (e.g. targets to override). -->
<!-- If you delete this file and reopen the project it will be recreated. -->
<project name="openmole-ide-ant" basedir=".">
    <description>Builds the module suite openmole-ide-ant.</description>
    <import file="nbproject/build-impl.xml"/>
    <!-- Create the cluster for openmole core modules -->
    <ant antfile="${harness.dir}/suite.xml" target="clusterize">
        <property name="cluster" location="openmole-cluster/target/"/>
        <property name="includes" value="dependency/*.jar"/>
    </ant>

    <!-- adjust window title -->
    <target name="build-brand" depends="-init">
        <property name="branding-startup" value="${basedir}/branding/core/core.jar/org/netbeans/core/startup/"/>
        <copy file="${branding-startup}/Bundle_template.properties" tofile="${branding-startup}/Bundle.properties"/>
        <propertyfile file="${branding-startup}/Bundle.properties" comment="Updated by build script">
            <entry key="currentVersion" value="${app.title} ${app.version} " />
        </propertyfile>
        <property name="branding-windows" value="${basedir}/branding/modules/org-netbeans-core-windows.jar/org/netbeans/core/windows/view/ui/"/>
        <copy file="${branding-windows}/Bundle_template.properties" tofile="${branding-windows}/Bundle.properties"/>
        <propertyfile file="${branding-windows}/Bundle.properties" comment="Updated by build script">
            <entry key="CTL_MainWindow_Title" value="${app.title} ${app.version}" />
            <entry key="CTL_MainWindow_Title_No_Project" value="${app.title} ${app.version}" />
        </propertyfile>
    </target>

    <!-- post dist zip operations -->
    <target name="build-zip" depends="suite.build-zip">
        <property name="nbdist.dir" value="dist"/>
        <property name="release.dir" value="${nbdist.dir}/${app.name}"/>
        <unzip src="${nbdist.dir}/${app.name}.zip" dest="${nbdist.dir}"/>
        <delete file="${nbdist.dir}/${app.name}.zip"/>

        <!-- adjust launching arguments to configure logger -->
        <replace file="${nbdist.dir}/${app.name}/etc/${app.name}.conf">
            <replacefilter token="/dev" value="/${app.version}" />
            <replacefilter token="-J-Xms24m -J-Xmx64m" value="-J-Xms24m -J-Xmx256m -J-Dorg.openide.util.lookup.MetaInfServicesLookup.level=OFF -J-Dorg.openmole.level=ALL" />
        </replace>
        <!-- rebuild the zip -->
        <zip destfile="${nbdist.dir}/${app.name}_${app.version}.zip">
            <zipfileset dir="${nbdist.dir}/${app.name}" prefix="${app.name}_${app.version}" includes="**" excludes="bin/${app.name}"/>
            <!-- set the script executable -->
            <zipfileset dir="${nbdist.dir}/${app.name}" prefix="${app.name}_${app.version}" includes="bin/${app.name}" filemode="744"/>
        </zip>

        <echo message=" "/>
        <echo message="cleaning and finalizing release" />
        <!--delete dir="${nbdist.dir}/${app.name}"/-->
    </target>
</project>
